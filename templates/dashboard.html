{% extends "base.html" %}
{% block title%}Dashboard{% endblock %}

{% block content%}


<div class="container-md-4">
<div class="card">
    <div class="card-body" >
        <p class="card-title">Recorded carbon emissions</p>
        <hr>
        <canvas id="myChart"  style="max-height:250px ;"></canvas>
    </div>
</div>
</div>

<table class="table table-striped">
    <thead>
        <tr>
          <th>Form ID</th>
          <th>Total Carbon Emissions</th>
          <th>Delete</th>
        </tr>
      </thead>
      <tbody>
      
        {% for c in range(1, counting+1) %}
        <tr>
          <td> {{ c }} </td>
          
          
          <td>{{ '{0:.2f}'.format(tot[c-1]) }}</td>
          
          <td><a href="/deleteform/{{ session['useremail'] }}/{{ c }}" class="btn btn-danger">Delete</a></td>

          </td>
        </tr>
        {% endfor %}
      
      </tbody>
  
</table>

<script>

    const horizontalavg = {
        id: 'horizontalavg',
        beforeline(chart, args, options) {
            const { ctx, chartArea: { top, right, bottom, left, width, height },
        scales: { x, y }} = chart;

        ctx.save();

        // horizontal line drawing
        ctx.strokeStyle = 'grey';
        ctx.setLineDash([10, 5]);

        ctx.strokeRect(left, y.getPixelForValue(8.56), width, 0);
        ctx.restore();
        }
    };
    // datelist = []
    // for (var i = 0; i < arrayLength; i++) {
    // console.log(myStringArray[i]);
    // datelist.append(i)
    // }
    // var datedate = {{ dates }};
    var labels = [{% for i in range(1, counting+1) %} {{ i }} ,{% endfor %}];
    // var labels = []
    // for (let i = 0; i < datedate.length; i++) {
    // labels.append(i);
    // }


    var config = {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [
            //     {
            //     label: 'Carbon footprint',
            //     data: [{% for item in tot %} {{item}} ,{% endfor %}],
            //     backgroundColor: ['rgba(75, 192, 192, 0.2)',],
            //     borderColor: ['rgba(75, 192, 192, 1)',],
            //     borderWidth: 1
            // }
            {
                label: 'Utilities',
                data: [{% for item in uty %} {{item}} ,{% endfor %}],
                backgroundColor: ['rgba(255, 159, 64, 0.8)',],
                borderColor: ['rgba(255, 159, 64, 1)',],
                borderWidth: 1
            },
            {
                label: 'Transport',
                data: [{% for item in tr %} {{item}} ,{% endfor %}],
                backgroundColor: ['rgba(75, 192, 192, 0.8)',],
                borderColor: ['rgba(75, 192, 192, 1)',],
                borderWidth: 1
            },
            {
                label: 'Food',
                data: [{% for item in fo %} {{item}} ,{% endfor %}],
                backgroundColor: ['rgba(54, 162, 235, 0.8)',],
                borderColor: ['rgba(54, 162, 235, 1)',],
                borderWidth: 1
            },
            {
                label: 'Others',
                data: [{% for item in oth %} {{item}} ,{% endfor %}],
                backgroundColor: ['rgba(153, 102, 255, 0.8)',],
                borderColor: ['rgba(153, 102, 255, 1)',],
                borderWidth: 1
            },
        ]
        },
        options: {
            scales: {
                x:{
                stacked: true,
            //     type: 'time',
            //     time: {
            //     unit :'day',
            //     parser: 'dd:mm:yyyy'
            // }
          },
                y: {
                    stacked: true,
                    beginAtZero: true
                }
            },
            
            
        },
        // plugins: [horizontalavg]
        // plugins: {
        //     tooltip: {
        //         callbacks: {
        //         afterBody: function(context) {
        //             return '%';
        //         }
        //     }
        //     }
        // }
        // plugins: [ChartDateLabel],
    };

    const ctx = document.getElementById('myChart');
    const myChart = new Chart(ctx, config);
    </script>
<br>
<br>
<h2 style = "text-align: center;">Tips for you to help combat climate change</h2>
<br>
<div style = "display:flex; gap:20px; justify-content:center;flex-wrap:wrap">

{% set counter = 0 %}

{% if stats[-1][0]>=15%}

    <div class="card" style="width: 18rem;">
        <img src="https://www.thoughtco.com/thmb/NjWNoDg8rEZ4KVQMUq3xwp3G6tU=/735x0/lightbulblit-57a5bf6b5f9b58974aee831e.jpg" class="card-img-top" alt="...">
        <div class="card-body">
          <p class="card-text">Some quick example text on elec</p>
        </div>
      </div>
      {% set counter=counter+1%}

{%endif%}
{% if stats[-1][1]>=15%}

<div class="card" style="width: 18rem;">
    <img src="https://www.thoughtco.com/thmb/NjWNoDg8rEZ4KVQMUq3xwp3G6tU=/735x0/lightbulblit-57a5bf6b5f9b58974aee831e.jpg" class="card-img-top" alt="...">
    <div class="card-body">
      <p class="card-text">Some quick example text on gas</p>
    </div>

</div>
{% set counter=counter+1%}

{%endif%}


{%if stats[-1][2]>=50%}
<div class="card" style="width: 18rem;">
    <img src="..." class="card-img-top" alt="...">
    <div class="card-body">
      <p class="card-text">Some quick example text on water</p>
    </div>
</div>
{% set counter=counter+1%}
{%endif%}



{%if (stats[-1][3]+stats[-1][4])>=50%}
<div class="card" style="width: 18rem;">
    <img src="https://www.thoughtco.com/thmb/NjWNoDg8rEZ4KVQMUq3xwp3G6tU=/735x0/lightbulblit-57a5bf6b5f9b58974aee831e.jpg" class="card-img-top" alt="...">
    <div class="card-body">
      <p class="card-text">Taking private transport pls</p>
    </div>
</div>
{% set counter=counter+1%}
{%endif%}



{%if (stats[-1][5]+stats[-1][6]+stats[-1][7]+stats[-1][7]+stats[-1][8]+stats[-1][9])>=2%}
<div class="card" style="width: 18rem;">
    <img src="https://www.thoughtco.com/thmb/NjWNoDg8rEZ4KVQMUq3xwp3G6tU=/735x0/lightbulblit-57a5bf6b5f9b58974aee831e.jpg" class="card-img-top" alt="...">
    <div class="card-body">
      <p class="card-text">Some quick example text on water</p>
    </div>
</div>
{% set counter=counter+1%}
{%endif%}



{%if stats[-1][10]>=50%}
<div class="card" style="width: 18rem;">
    <img src="https://www.thoughtco.com/thmb/NjWNoDg8rEZ4KVQMUq3xwp3G6tU=/735x0/lightbulblit-57a5bf6b5f9b58974aee831e.jpg" class="card-img-top" alt="...">
    <div class="card-body">
      <p class="card-text">Others</p>
    </div>
</div>
{% set counter=counter+1%}
{%endif%}




{% if counter==0%}

<div style = "padding: 100px 200px; border:0.5px solid #000000;border-radius: 25px;">
    <p style = "font-size: 15px;"><em>No Tips! Keep Up the Good Work!</em></p>
</div>


{%endif%}


</div>
<style>
    img{
        -webkit-user-drag: none;
    }

</style>
<!-- 
{% for i in stats[0] %}

<p>{{i}}</p>

{% endfor %} -->

<br>
<h5>Want to know more about Singapore's carbon emissions?<a href="\#sgcarbon"> Click Here!</a></h5>
<br>
{% endblock %}
